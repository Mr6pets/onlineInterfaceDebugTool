# 常见问题

<cite>
**本文档中引用的文件**  
- [environment.ts](file://packages/web-full/src/stores/environment.ts)
- [collection.ts](file://packages/web-full/src/stores/collection.ts)
- [batchTest.ts](file://packages/web-full/src/stores/batchTest.ts)
- [team.ts](file://packages/web-full/src/stores/team.ts)
- [README.md](file://README.md)
</cite>

## 目录
1. [简介](#简介)
2. [安装与构建问题](#安装与构建问题)
3. [功能使用异常](#功能使用异常)
4. [高级功能配置问题](#高级功能配置问题)
5. [日志与调试技巧](#日志与调试技巧)
6. [社区贡献与问题索引](#社区贡献与问题索引)

## 简介
本故障排除指南旨在帮助用户解决在使用在线接口调试工具过程中可能遇到的各类问题。涵盖从安装部署、功能使用到高级配置的全生命周期问题，提供清晰的症状描述、根本原因分析和分步解决方案。通过系统化的分类和详细的调试指引，帮助用户快速恢复正常使用。

## 安装与构建问题

### 依赖安装失败
**症状**：执行 `pnpm install` 时出现包下载失败、版本冲突或权限错误。

**根本原因**：
- 网络连接问题导致无法访问包仓库
- pnpm 版本不兼容
- 本地缓存损坏
- 权限不足（特别是在全局安装时）

**解决方案**：
1. 确保网络连接正常，尝试更换网络环境
2. 检查 pnpm 版本是否符合项目要求（建议使用 pnpm v8+）
3. 清理缓存并重试：
   ```bash
   pnpm store prune
   pnpm install
   ```
4. 若在 Windows 上遇到权限问题，以管理员身份运行终端

**Section sources**
- [README.md](file://README.md#L10-L15)

### 构建版本失败
**症状**：执行 `pnpm build:lite`、`pnpm build:full` 或 `pnpm build:pro` 时编译报错。

**根本原因**：
- TypeScript 类型检查失败
- Vite 配置错误
- 共享模块导入路径问题
- 环境变量未正确注入

**解决方案**：
1. 检查 `packages/*/vite.config.ts` 中的路径别名配置
2. 确保 `@shared` 模块正确构建并可用
3. 运行类型检查定位问题：
   ```bash
   pnpm run type-check
   ```
4. 查看具体错误日志，重点关注模块解析和类型错误

**Section sources**
- [README.md](file://README.md#L20-L25)

## 功能使用异常

### 请求执行失败
**症状**：在 API 调试界面发送请求时，返回网络错误或超时。

**根本原因**：
- CORS 策略限制
- 请求配置错误（URL、方法、头信息）
- 网络代理设置问题
- 浏览器安全策略

**解决方案**：
1. 检查目标 API 是否支持跨域请求
2. 验证请求 URL 是否完整且正确
3. 尝试在浏览器开发者工具中查看具体的网络错误
4. 对于本地测试 API，考虑使用代理服务器或禁用浏览器安全策略（仅限开发环境）

**Section sources**
- [collection.ts](file://packages/web-full/src/stores/collection.ts#L300-L350)

### 环境切换无效
**症状**：切换环境后，请求中使用的变量未更新。

**根本原因**：
- 当前环境状态未正确同步
- 变量作用域冲突
- 存储同步延迟

**解决方案**：
1. 确认环境切换操作已成功执行
2. 检查 `useEnvironmentStore` 中的 `switchEnvironment` 方法调用
3. 验证当前环境变量是否已正确加载：
   ```ts
   const { currentEnvironment } = useEnvironmentStore()
   console.log(currentEnvironment.value?.variables)
   ```
4. 强制刷新页面以重新加载环境状态

**Section sources**
- [environment.ts](file://packages/web-full/src/stores/environment.ts#L250-L300)

### 数据丢失问题
**症状**：重启应用后，之前创建的集合、环境或历史记录消失。

**根本原因**：
- 本地存储（localStorage）被清除
- 存储序列化/反序列化错误
- 异步存储操作未完成即关闭页面

**解决方案**：
1. 检查浏览器 localStorage 是否被手动清除
2. 确保存储操作已正确完成：
   ```ts
   await saveEnvironments()
   await saveCollections()
   ```
3. 在页面卸载前确保所有异步保存操作完成
4. 检查存储工具的错误处理：
   ```ts
   const storage = {
     set: (key, value) => {
       try {
         localStorage.setItem(key, JSON.stringify(value))
       } catch (error) {
         console.error('Storage error:', error)
       }
     }
   }
   ```

**Section sources**
- [environment.ts](file://packages/web-full/src/stores/environment.ts#L100-L150)
- [collection.ts](file://packages/web-full/src/stores/collection.ts#L150-L200)

## 高级功能配置问题

### 团队权限不生效
**症状**：成员角色变更后，权限未相应更新。

**根本原因**：
- 权限映射未同步更新
- 当前用户权限缓存未刷新
- 角色到权限的映射逻辑错误

**解决方案**：
1. 检查 `updateMemberRole` 方法中权限更新逻辑：
   ```ts
   if (role === 'admin') {
     member.permissions = ['all']
   }
   ```
2. 确保权限检查函数 `hasPermission` 正确实现
3. 验证当前用户权限是否已刷新：
   ```ts
   const { currentUser } = useTeamStore()
   console.log(currentUser.value?.permissions)
   ```
4. 重新加载团队数据以同步最新状态

**Section sources**
- [team.ts](file://packages/web-full/src/stores/team.ts#L250-L300)

### 自动化测试调度失败
**症状**：批量测试套件无法正常执行或调度。

**根本原因**：
- 测试套件状态管理错误
- 并发控制逻辑问题
- 请求执行超时
- 测试结果存储失败

**解决方案**：
1. 检查测试套件的运行状态：
   ```ts
   const { isRunning } = useBatchTestStore()
   console.log(isRunning(suiteId))
   ```
2. 验证并发设置是否合理：
   ```ts
   const defaultSettings = { concurrency: 1, timeout: 30000 }
   ```
3. 检查 `executeTestRequests` 方法中的错误处理
4. 确保测试结果能正确保存：
   ```ts
   await saveTestResults()
   ```

**Section sources**
- [batchTest.ts](file://packages/web-full/src/stores/batchTest.ts#L200-L300)

## 日志与调试技巧

### 日志查看方法
应用使用控制台日志和 Element Plus 消息组件进行状态反馈。

**关键日志位置**：
- 存储操作错误：`console.error('Storage error:', error)`
- API 调用失败：`console.error('Failed to execute request:', error)`
- 权限检查失败：`console.error('Permission check failed:', error)`

**启用详细日志**：
在开发模式下，所有状态变更和操作都会输出到控制台。可通过浏览器开发者工具的 Console 面板查看。

### 调试工具使用技巧
1. **Vue DevTools**：检查 Pinia store 的状态变化
2. **Network 面板**：监控 API 请求和响应
3. **Application 面板**：查看 localStorage 存储数据
4. **Sources 面板**：设置断点调试关键逻辑

### 关键代码断点位置指引
```ts
// 环境管理
[environment.ts] switchEnvironment() #L250-L300
[environment.ts] loadEnvironments() #L100-L150

// 集合管理
[collection.ts] executeRequest() #L300-L350
[collection.ts] loadCollections() #L150-L200

// 批量测试
[batchTest.ts] runTestSuite() #L200-L300
[batchTest.ts] executeTestRequest() #L400-L450

// 团队管理
[team.ts] updateMemberRole() #L250-L300
[team.ts] hasPermission() #L80-L90
```

## 社区贡献与问题索引
我们鼓励用户贡献遇到的问题案例，共同完善本指南。可通过以下方式参与：

1. Fork 项目并提交 Pull Request
2. 在 Issues 中报告新问题
3. 分享解决方案和最佳实践

**问题索引体系**：
- 按问题类型分类（安装、功能、配置）
- 按组件模块索引（环境、集合、团队、测试）
- 按严重程度分级（低、中、高、紧急）
- 包含关键词搜索功能

通过持续维护和更新，确保本指南始终保持最新和最全面的状态。

**Section sources**
- [README.md](file://README.md#L100-L109)