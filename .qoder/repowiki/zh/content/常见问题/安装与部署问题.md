# å®‰è£…ä¸éƒ¨ç½²é—®é¢˜

<cite>
**æœ¬æ–‡æ¡£å¼•ç”¨çš„æ–‡ä»¶**  
- [package.json](file://package.json)
- [pnpm-workspace.yaml](file://pnpm-workspace.yaml)
- [tsconfig.json](file://tsconfig.json)
- [scripts/build.js](file://scripts/build.js)
- [packages/shared/package.json](file://packages/shared/package.json)
- [packages/web-lite/package.json](file://packages/web-lite/package.json)
- [packages/web-full/package.json](file://packages/web-full/package.json)
- [packages/web-pro/package.json](file://packages/web-pro/package.json)
- [packages/shared/tsconfig.json](file://packages/shared/tsconfig.json)
</cite>

## ç›®å½•
1. [ç®€ä»‹](#ç®€ä»‹)
2. [é¡¹ç›®ç»“æ„ä¸ä¾èµ–ç®¡ç†æœºåˆ¶](#é¡¹ç›®ç»“æ„ä¸ä¾èµ–ç®¡ç†æœºåˆ¶)
3. [å…¸å‹å®‰è£…ä¸éƒ¨ç½²é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ](#å…¸å‹å®‰è£…ä¸éƒ¨ç½²é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ)
4. [æ„å»ºè„šæœ¬æ‰§è¡Œå¼‚å¸¸æ’æŸ¥](#æ„å»ºè„šæœ¬æ‰§è¡Œå¼‚å¸¸æ’æŸ¥)
5. [Viteå¼€å‘æœåŠ¡å™¨å¯åŠ¨æŠ¥é”™å¤„ç†](#viteå¼€å‘æœåŠ¡å™¨å¯åŠ¨æŠ¥é”™å¤„ç†)
6. [TypeScriptç¼–è¯‘é”™è¯¯ä¸ç±»å‹æ£€æŸ¥](#typescriptç¼–è¯‘é”™è¯¯ä¸ç±»å‹æ£€æŸ¥)
7. [å…±äº«åŒ…å¼•ç”¨å¤±è´¥è¯Šæ–­](#å…±äº«åŒ…å¼•ç”¨å¤±è´¥è¯Šæ–­)
8. [ç¯å¢ƒå˜é‡é…ç½®ç¼ºå¤±é—®é¢˜](#ç¯å¢ƒå˜é‡é…ç½®ç¼ºå¤±é—®é¢˜)
9. [æ—¥å¿—æŸ¥çœ‹ä¸è°ƒè¯•æ¨¡å¼å¯ç”¨](#æ—¥å¿—æŸ¥çœ‹ä¸è°ƒè¯•æ¨¡å¼å¯ç”¨)
10. [é™„å½•ï¼šå¸¸ç”¨å‘½ä»¤é€ŸæŸ¥](#é™„å½•å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥)

## ç®€ä»‹
æœ¬æŒ‡å—æ—¨åœ¨ä¸º `online-interface-debug-tool` é¡¹ç›®æä¾›å…¨é¢çš„å®‰è£…éƒ¨ç½²æ•…éšœæ’é™¤æ”¯æŒã€‚è¯¥é¡¹ç›®é‡‡ç”¨ PNPM Workspaces æ„å»ºçš„ Monorepo æ¶æ„ï¼ŒåŒ…å«å¤šä¸ªå‰ç«¯å­åŒ…ï¼ˆweb-liteã€web-fullã€web-proï¼‰å’Œä¸€ä¸ªå…±äº«åº“ï¼ˆsharedï¼‰ã€‚æ–‡æ¡£å°†æ·±å…¥è§£æä¾èµ–ç®¡ç†æœºåˆ¶ï¼Œå¹¶é’ˆå¯¹å¸¸è§é—®é¢˜å¦‚ä¾èµ–å®‰è£…å¤±è´¥ã€æ„å»ºè„šæœ¬å¼‚å¸¸ã€å¼€å‘æœåŠ¡å™¨å¯åŠ¨é”™è¯¯ç­‰æä¾›ç³»ç»Ÿæ€§è§£å†³æ–¹æ¡ˆã€‚

## é¡¹ç›®ç»“æ„ä¸ä¾èµ–ç®¡ç†æœºåˆ¶

```mermaid
graph TD
A[æ ¹ç›®å½•] --> B[packages]
B --> C[shared]
B --> D[web-lite]
B --> E[web-full]
B --> F[web-pro]
A --> G[scripts/build.js]
A --> H[package.json]
A --> I[pnpm-workspace.yaml]
A --> J[tsconfig.json]
C --> K[å…±äº«ç±»å‹ä¸å·¥å…·å‡½æ•°]
D --> L[è½»é‡ç‰ˆç•Œé¢]
E --> M[å®Œæ•´ç‰ˆåŠŸèƒ½]
F --> N[ä¸“ä¸šç‰ˆå¢å¼º]
H --> |workspaces| B
J --> |paths| C
G --> |æ„å»ºæµç¨‹| D & E & F
```

**Diagram sources**
- [package.json](file://package.json#L5-L8)
- [pnpm-workspace.yaml](file://pnpm-workspace.yaml#L1-L2)
- [tsconfig.json](file://tsconfig.json#L25-L27)

**Section sources**
- [package.json](file://package.json#L1-L36)
- [pnpm-workspace.yaml](file://pnpm-workspace.yaml#L1-L2)
- [tsconfig.json](file://tsconfig.json#L1-L35)

## å…¸å‹å®‰è£…ä¸éƒ¨ç½²é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

### PNPMå·¥ä½œåŒºä¾èµ–å®‰è£…å¤±è´¥
å½“æ‰§è¡Œ `pnpm install` æ—¶å‡ºç°è·¨åŒ…ä¾èµ–è§£æå¤±è´¥æˆ–ç‰ˆæœ¬å†²çªï¼Œé€šå¸¸ç”±ä»¥ä¸‹åŸå› å¯¼è‡´ï¼š
- Node.js æˆ– PNPM ç‰ˆæœ¬ä¸ç¬¦åˆè¦æ±‚ï¼ˆéœ€ Node >=16, PNPM >=8ï¼‰
- ç¼“å­˜æŸåæˆ– `node_modules` çŠ¶æ€ä¸ä¸€è‡´
- å·¥ä½œåŒºé“¾æ¥å¤±è´¥ï¼ˆå¦‚ `@api-debug-tool/shared` æ— æ³•æ­£ç¡®é“¾æ¥ï¼‰

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ¸…ç†å¹¶é‡æ–°å®‰è£…ï¼š
```bash
pnpm clean
rm -rf node_modules pnpm-lock.yaml
pnpm install
```
2. å¼ºåˆ¶é‡å»ºé“¾æ¥ï¼š
```bash
pnpm install --force
```

### è·¨åŒ…ä¾èµ–è§£æé”™è¯¯
åœ¨ `web-full` æˆ– `web-pro` ä¸­å¼•ç”¨ `@api-debug-tool/shared` æŠ¥é”™ï¼Œå¯èƒ½ç”±äºï¼š
- `package.json` ä¸­æœªæ­£ç¡®å£°æ˜ `workspace:*` ä¾èµ–
- TypeScript è·¯å¾„æ˜ å°„æœªç”Ÿæ•ˆ

**éªŒè¯æ­¥éª¤ï¼š**
- æ£€æŸ¥ `packages/web-full/package.json` æ˜¯å¦åŒ…å« `"@api-debug-tool/shared": "workspace:*"`
- ç¡®è®¤æ ¹ç›®å½• `tsconfig.json` ä¸­ `"@shared/*": ["./packages/shared/*"]` é…ç½®æ­£ç¡®

**Section sources**
- [packages/web-full/package.json](file://packages/web-full/package.json#L15-L16)
- [packages/web-pro/package.json](file://packages/web-pro/package.json#L10-L11)
- [tsconfig.json](file://tsconfig.json#L25-L27)

## æ„å»ºè„šæœ¬æ‰§è¡Œå¼‚å¸¸æ’æŸ¥

### build.js è¿è¡Œå¤±è´¥
`scripts/build.js` è„šæœ¬è´Ÿè´£ä¾æ¬¡æ„å»ºä¸‰ä¸ªç‰ˆæœ¬å¹¶èšåˆè¾“å‡ºåˆ° `/dist`ã€‚å¸¸è§å¤±è´¥ç‚¹åŒ…æ‹¬ï¼š
- å­é¡¹ç›®æ„å»ºå‘½ä»¤å¤±è´¥ï¼ˆå¦‚ `vite build` æŠ¥é”™ï¼‰
- æ–‡ä»¶ç³»ç»Ÿæƒé™é—®é¢˜å¯¼è‡´æ— æ³•åˆ é™¤æˆ–åˆ›å»ºç›®å½•
- å¹¶è¡Œæ„å»ºæ—¶èµ„æºç«äº‰

**è¯Šæ–­æµç¨‹ï¼š**
1. æ£€æŸ¥ `build.js` è¾“å‡ºæ—¥å¿—ï¼Œå®šä½å…·ä½“å¤±è´¥ç‰ˆæœ¬
2. å•ç‹¬è¿è¡Œè¯¥ç‰ˆæœ¬æ„å»ºå‘½ä»¤éªŒè¯ï¼š
```bash
pnpm --filter web-lite build
```
3. ç¡®ä¿ `dist` ç›®å½•å¯å†™ï¼Œä¸”æ— è¿›ç¨‹å ç”¨

```mermaid
flowchart TD
Start([å¼€å§‹æ„å»º]) --> Clean["æ¸…ç† dist ç›®å½•"]
Clean --> BuildLite["æ„å»º Lite ç‰ˆæœ¬"]
BuildLite --> CheckLite{"æˆåŠŸ?"}
CheckLite --> |å¦| ErrorLite["è®°å½•é”™è¯¯å¹¶ç»§ç»­"]
CheckLite --> |æ˜¯| CopyLite["å¤åˆ¶æ„å»ºç»“æœ"]
CopyLite --> BuildFull["æ„å»º Full ç‰ˆæœ¬"]
BuildFull --> CheckFull{"æˆåŠŸ?"}
CheckFull --> |å¦| ErrorFull["è®°å½•é”™è¯¯å¹¶ç»§ç»­"]
CheckFull --> |æ˜¯| CopyFull["å¤åˆ¶æ„å»ºç»“æœ"]
CopyFull --> BuildPro["æ„å»º Pro ç‰ˆæœ¬"]
BuildPro --> CheckPro{"æˆåŠŸ?"}
CheckPro --> |å¦| ErrorPro["è®°å½•é”™è¯¯å¹¶ç»§ç»­"]
CheckPro --> |æ˜¯| CopyPro["å¤åˆ¶æ„å»ºç»“æœ"]
CopyPro --> End["æ‰€æœ‰ç‰ˆæœ¬æ„å»ºå®Œæˆ"]
ErrorLite --> BuildFull
ErrorFull --> BuildPro
ErrorPro --> End
```

**Diagram sources**
- [scripts/build.js](file://scripts/build.js#L1-L38)

**Section sources**
- [scripts/build.js](file://scripts/build.js#L1-L38)
- [package.json](file://package.json#L10-L15)

## Viteå¼€å‘æœåŠ¡å™¨å¯åŠ¨æŠ¥é”™å¤„ç†

### å¯åŠ¨å‘½ä»¤è¯´æ˜
å„å­é¡¹ç›®é€šè¿‡ä»¥ä¸‹å‘½ä»¤å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼š
- `pnpm dev:lite` â†’ `web-lite`
- `pnpm dev:full` â†’ `web-full`ï¼ˆç«¯å£ 3001ï¼‰
- `pnpm dev:pro` â†’ `web-pro`ï¼ˆç«¯å£ 3002ï¼‰

### å¸¸è§å¯åŠ¨é”™è¯¯
- **ç«¯å£å ç”¨**ï¼šä¿®æ”¹ `vite.config.ts` æˆ–ä½¿ç”¨ `--port` è¦†ç›–
- **ä¾èµ–ç¼ºå¤±**ï¼šç¡®ä¿å·²è¿è¡Œ `pnpm install`
- **TypeScript ç±»å‹é”™è¯¯**ï¼šè¿è¡Œ `pnpm type-check` é¢„æ£€

**è°ƒè¯•å»ºè®®ï¼š**
- å¯ç”¨ Vite è°ƒè¯•æ—¥å¿—ï¼š`pnpm dev:full --debug`
- æ£€æŸ¥ `vite.config.ts` æ˜¯å¦å­˜åœ¨è¯­æ³•é”™è¯¯

**Section sources**
- [package.json](file://package.json#L9-L14)
- [packages/web-full/package.json](file://packages/web-full/package.json#L5-L7)

## TypeScriptç¼–è¯‘é”™è¯¯ä¸ç±»å‹æ£€æŸ¥

### ç±»å‹æ£€æŸ¥å‘½ä»¤
æ ¹ç›®å½•æä¾›ç»Ÿä¸€ç±»å‹æ£€æŸ¥ï¼š
```bash
pnpm type-check
```
è¯¥å‘½ä»¤è°ƒç”¨ `vue-tsc --noEmit`ï¼ŒåŸºäº `tsconfig.json` é…ç½®è¿›è¡Œç±»å‹éªŒè¯ã€‚

### å¸¸è§ç±»å‹é”™è¯¯
- å…±äº«åŒ…å¯¼å‡ºç±»å‹æœªæ­£ç¡®å£°æ˜
- å­é¡¹ç›® `tsconfig.json` æœªç»§æ‰¿æ ¹é…ç½®
- `@shared/*` è·¯å¾„åˆ«åæœªè¢«è¯†åˆ«

**è§£å†³æ–¹æ¡ˆï¼š**
1. ç¡®ä¿ `packages/shared/index.ts` æ­£ç¡®å¯¼å‡ºæ‰€éœ€ç±»å‹
2. æ£€æŸ¥å„å­é¡¹ç›® `tsconfig.json` æ˜¯å¦åŒ…å« `"extends": "../../tsconfig.json"`

**Section sources**
- [tsconfig.json](file://tsconfig.json#L1-L35)
- [package.json](file://package.json#L16-L17)

## å…±äº«åŒ…å¼•ç”¨å¤±è´¥è¯Šæ–­

### å¼•ç”¨æ–¹å¼
å­é¡¹ç›®é€šè¿‡ `@shared/*` åˆ«åå¼•ç”¨å…±äº«æ¨¡å—ï¼š
```ts
import { validator } from '@shared/utils'
```

### æ•…éšœæ’æŸ¥æ­¥éª¤
1. ç¡®è®¤ `tsconfig.json` ä¸­ `paths` é…ç½®æ­£ç¡®
2. æ£€æŸ¥ `packages/shared/package.json` çš„ `exports` å­—æ®µæ˜¯å¦å¯¼å‡ºå¯¹åº”è·¯å¾„
3. éªŒè¯ PNPM æ˜¯å¦æˆåŠŸé“¾æ¥åŒ…ï¼š
```bash
pnpm list @api-debug-tool/shared
```

**Section sources**
- [tsconfig.json](file://tsconfig.json#L25-L27)
- [packages/shared/package.json](file://packages/shared/package.json#L7-L12)

## ç¯å¢ƒå˜é‡é…ç½®ç¼ºå¤±é—®é¢˜

### å½“å‰é¡¹ç›®ç¯å¢ƒå˜é‡ä½¿ç”¨
æœ¬é¡¹ç›®æš‚æœªåœ¨ `package.json` æˆ–æ„å»ºè„šæœ¬ä¸­æ˜¾å¼ä½¿ç”¨ `.env` æ–‡ä»¶ã€‚è‹¥éœ€æ‰©å±•ç¯å¢ƒå˜é‡æ”¯æŒï¼š
- åœ¨å„å­é¡¹ç›®æ ¹ç›®å½•æ·»åŠ  `.env` æ–‡ä»¶
- ä½¿ç”¨ `import.meta.env` è®¿é—®å˜é‡
- ç¡®ä¿ `vite.config.ts` æ­£ç¡®é…ç½® `envPrefix`

**å»ºè®®å®è·µï¼š**
- ç»Ÿä¸€ç¯å¢ƒå˜é‡å‰ç¼€ï¼ˆå¦‚ `VITE_`ï¼‰
- æä¾› `.env.example` æ¨¡æ¿æ–‡ä»¶

## æ—¥å¿—æŸ¥çœ‹ä¸è°ƒè¯•æ¨¡å¼å¯ç”¨

### æŸ¥çœ‹æ„å»ºæ—¥å¿—
- æ„å»ºè„šæœ¬è¾“å‡ºåŒ…å«è¯¦ç»†çŠ¶æ€ï¼ˆğŸš€ã€âœ…ã€âŒï¼‰
- å¯é€šè¿‡ `--verbose` å‚æ•°å¢å¼ºæ—¥å¿—è¾“å‡ºï¼ˆéœ€ä¿®æ”¹ `build.js`ï¼‰

### å¯ç”¨è°ƒè¯•æ¨¡å¼
1. **Vite è°ƒè¯•**ï¼š
```bash
vite --debug
```
2. **Node.js è°ƒè¯•ï¼ˆbuild.jsï¼‰**ï¼š
```bash
node --inspect scripts/build.js
```
3. **PNPM è°ƒè¯•æ—¥å¿—**ï¼š
```bash
pnpm --reporter=ndjson install
```

**Section sources**
- [scripts/build.js](file://scripts/build.js#L1-L38)

## é™„å½•å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| `pnpm install` | å®‰è£…æ‰€æœ‰ä¾èµ– |
| `pnpm dev:lite` | å¯åŠ¨ Lite ç‰ˆå¼€å‘æœåŠ¡å™¨ |
| `pnpm dev:full` | å¯åŠ¨ Full ç‰ˆå¼€å‘æœåŠ¡å™¨ï¼ˆç«¯å£ 3001ï¼‰ |
| `pnpm dev:pro` | å¯åŠ¨ Pro ç‰ˆå¼€å‘æœåŠ¡å™¨ï¼ˆç«¯å£ 3002ï¼‰ |
| `pnpm build:all` | æ„å»ºæ‰€æœ‰ç‰ˆæœ¬ |
| `pnpm type-check` | æ‰§è¡Œ TypeScript ç±»å‹æ£€æŸ¥ |
| `pnpm clean` | æ¸…ç† node_modules |
| `pnpm list <pkg>` | æŸ¥çœ‹åŒ…é“¾æ¥çŠ¶æ€ |

**Section sources**
- [package.json](file://package.json#L9-L17)